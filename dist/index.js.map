{"version":3,"file":"index.js","sources":["../src/row.js","../src/index.js"],"sourcesContent":["import React, { memo } from 'react'\nimport PropTypes from 'prop-types'\nimport { areEqual } from 'react-window'\n\nconst Row = memo(({ data, index, style }) => {\n  const { rows, images, renderItem } = data\n  const itemsBelowIndex = rows\n    .filter((_, i) => i < index)\n    .map(row => row.contents.length)\n    .reduce((a, b) => a + b, 0)\n  return (\n    <div\n      key={index + rows[index].contents.length}\n      style={{\n        ...style,\n        height: rows[index].rowHeight\n      }}\n    >\n      {\n        rows[index].contents.map((content, i) => {\n          const image = images[itemsBelowIndex + i]\n          return renderItem(content, image)\n        })\n      }\n    </div>\n  )\n}, areEqual)\n\nRow.propTypes = {\n  data: PropTypes.object,\n  index: PropTypes.number,\n  style: PropTypes.object\n}\n\nexport default Row\n","import React, { Component, createRef } from 'react'\nimport PropTypes from 'prop-types'\nimport { VariableSizeList } from 'react-window'\nimport Row from './row'\n\nlet minimumRowHeight, maximumRowHeight\nexport default class DreamGrid extends Component {\n  static propTypes = {\n    minimumRowHeight: PropTypes.number,\n    maximumRowHeight: PropTypes.number,\n    size: PropTypes.objectOf(PropTypes.number),\n    images: PropTypes.object,\n    renderItem: PropTypes.func\n  }\n\n  constructor(props) {\n    super(props)\n    minimumRowHeight = props.minimumRowHeight\n    maximumRowHeight = props.maximumRowHeight\n    this.list = createRef()\n  }\n\n  componentDidUpdate(prevProps) {\n    const { height, width } = this.props.size\n    if (prevProps.size.height !== height || prevProps.size.width !== width) {\n      this.list.resetAfterIndex(0, true)\n    }\n  }\n\n  dimension = (x, y) => {\n    return { x, y }\n  }\n\n  scaleDimension = (dimension, scale) => {\n    return {\n      dimension: dimension,\n      scale: scale\n    }\n  }\n\n  row = (unscaledContents, scaleDueToHeight) => {\n    const width = this.props.size.width\n    const scaledContents = unscaledContents.map(unscaledDimension => {\n      const factor = this.factorToFitInMinimumRowHeight(unscaledDimension) * scaleDueToHeight\n      return this.scaleDimension(unscaledDimension, factor)\n    })\n\n    const remainingWhitespace = width - scaledContents\n      .map(scaledContent => scaledContent.dimension.x * scaledContent.scale)\n      .reduce((cur, prev) => { return cur + prev }, 0)\n\n    return {\n      contents: scaledContents,\n      rowHeight: minimumRowHeight * scaleDueToHeight,\n      horizontalWhitespace: remainingWhitespace\n    }\n  }\n\n  makeNextRow = (remainingDimensions) => {\n    const width = this.props.size.width\n    let remainingRowWidth = width\n    let accumulatedRowDimensions = []\n    while (remainingDimensions.length > 0 && remainingRowWidth > this.widthAtMinimumRowHeight(remainingDimensions[0])) {\n      remainingRowWidth -= this.widthAtMinimumRowHeight(remainingDimensions[0])\n      accumulatedRowDimensions.push(remainingDimensions.shift())\n    }\n\n    const widthsAtMinimumHeight = accumulatedRowDimensions.map(d => this.widthAtMinimumRowHeight(d))\n    const totalWidthAtMinimumHeight = widthsAtMinimumHeight.reduce((a, b) => { return a + b }, 0)\n    const widthScaleFactor = Math.min(width / totalWidthAtMinimumHeight, maximumRowHeight / minimumRowHeight)\n    return {\n      next: this.row(accumulatedRowDimensions, widthScaleFactor),\n      remaining: remainingDimensions\n    }\n  }\n\n  makeRows = (accumulatedRows, dimensions) => {\n    const { next, remaining } = this.makeNextRow(dimensions)\n    accumulatedRows.push(next)\n    if (remaining.length > 0) {\n      accumulatedRows.concat(this.makeRows(accumulatedRows, remaining))\n    }\n    return accumulatedRows\n  }\n\n  widthAtMinimumRowHeight = (dimension) => {\n    return this.factorToFitInMinimumRowHeight(dimension) * dimension.x\n  }\n\n  factorToFitInMinimumRowHeight = (dimension) => {\n    return minimumRowHeight / dimension.y\n  }\n\n  getImageDimensions = (image) => {\n    const { width, height } = image\n    switch (image.image_orientation) {\n      case 'LeftBottom':\n        return {\n          x: height,\n          y: width\n        }\n      default:\n        return {\n          x: width,\n          y: height\n        }\n    }\n  }\n\n  makeDimensions = () => {\n    const { images } = this.props\n    return images.filter(({ width, height }) => {\n      return width && height\n    }).map((image) => {\n      const { x, y } = this.getImageDimensions(image)\n      return this.dimension(x, y)\n    })\n  }\n\n  getItemSize = index => {\n    return this.rows[index].rowHeight\n  };\n\n  render() {\n    const { images, size, renderItem } = this.props\n    const { height, width } = size\n    const imageDimensions = this.makeDimensions()\n    this.rows = this.makeRows([], imageDimensions)\n    const itemData = { rows: this.rows, images, renderItem }\n    return (\n      <VariableSizeList\n        height={height}\n        width={width}\n        itemData={itemData}\n        itemSize={this.getItemSize}\n        itemCount={this.rows.length}\n        ref={(node) => { this.list = node }}\n      >\n        {Row}\n      </VariableSizeList>\n    )\n  }\n}\n"],"names":["Row","memo","data","index","style","rows","images","renderItem","itemsBelowIndex","filter","_","i","map","row","contents","length","reduce","a","b","React","rowHeight","content","image","areEqual","propTypes","PropTypes","object","number","minimumRowHeight","maximumRowHeight","DreamGrid","props","dimension","x","y","scaleDimension","scale","unscaledContents","scaleDueToHeight","width","size","scaledContents","factor","factorToFitInMinimumRowHeight","unscaledDimension","remainingWhitespace","scaledContent","cur","prev","makeNextRow","remainingDimensions","remainingRowWidth","accumulatedRowDimensions","widthAtMinimumRowHeight","push","shift","widthsAtMinimumHeight","d","totalWidthAtMinimumHeight","widthScaleFactor","Math","min","makeRows","accumulatedRows","dimensions","next","remaining","concat","getImageDimensions","height","image_orientation","makeDimensions","getItemSize","list","createRef","prevProps","resetAfterIndex","imageDimensions","itemData","node","Component","objectOf","func"],"mappings":"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"}