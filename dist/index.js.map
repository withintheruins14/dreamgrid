{"version":3,"file":"index.js","sources":["../src/row.js","../src/index.js"],"sourcesContent":["import React, { memo } from 'react'\nimport PropTypes from 'prop-types'\nimport { areEqual } from 'react-window'\n\nconst Row = memo(({ data, index, style }) => {\n  const { rows, images, renderItem } = data\n  return (\n    <div\n      key={index + rows[index].contents.length}\n      style={{\n        ...style,\n        height: rows[index].rowHeight\n      }}\n    >\n      {\n        rows[index].contents.map((content, i) => {\n          const image = images.byId[content.dimension.id]\n          return renderItem(data, content, index + i, image)\n        })\n      }\n    </div>\n  )\n}, areEqual)\n\nRow.propTypes = {\n  data: PropTypes.object,\n  index: PropTypes.number,\n  style: PropTypes.object\n}\n\nexport default Row\n","import React, { Component, createRef } from 'react'\nimport PropTypes from 'prop-types'\nimport { VariableSizeList } from 'react-window'\nimport Row from './row'\n// import styles from './styles.css'\n\nlet minimumRowHeight, maximumRowHeight\nexport default class DreamGrid extends Component {\n  static propTypes = {\n    minimumRowHeight: PropTypes.number,\n    maximumRowHeight: PropTypes.number,\n    size: PropTypes.objectOf(PropTypes.number),\n    images: PropTypes.object,\n    renderItem: PropTypes.function\n  }\n\n  constructor(props) {\n    super(props)\n    minimumRowHeight = props.minimumRowHeight\n    maximumRowHeight = props.maximumRowHeight\n    this.list = createRef()\n  }\n  //\n  // componentDidMount() {\n  //   console.log(this.list);\n  //     this.list.scrollToItem(this.rows.length+1);\n  // }\n\n  componentDidUpdate(prevProps) {\n    const { height, width } = this.props.size\n    if (prevProps.size.height !== height || prevProps.size.width !== width) {\n      this.list.resetAfterIndex(0, true)\n    }\n  }\n\n  dimension = (x, y) => {\n    return { x, y }\n  }\n\n  scaleDimension = (dimension, scale) => {\n    return {\n      dimension: dimension,\n      scale: scale\n    }\n  }\n\n  row = (unscaledContents, scaleDueToHeight) => {\n    const width = this.props.size.width\n    const scaledContents = unscaledContents.map(unscaledDimension => {\n      const factor = this.factorToFitInMinimumRowHeight(unscaledDimension) * scaleDueToHeight;\n      return this.scaleDimension(unscaledDimension, factor)\n    })\n\n    const remainingWhitespace = width - scaledContents\n      .map(scaledContent => scaledContent.dimension.x * scaledContent.scale)\n      .reduce((cur, prev) => { return cur + prev }, 0)\n\n    return {\n      contents: scaledContents,\n      rowHeight: minimumRowHeight * scaleDueToHeight,\n      horizontalWhitespace: remainingWhitespace\n    }\n  }\n\n  makeNextRow = (remainingDimensions) => {\n    const width = this.props.size.width\n    let remainingRowWidth = width\n    let accumulatedRowDimensions = []\n    while (remainingDimensions.length > 0 && remainingRowWidth > this.widthAtMinimumRowHeight(remainingDimensions[0])) {\n      remainingRowWidth -= this.widthAtMinimumRowHeight(remainingDimensions[0]);\n      accumulatedRowDimensions.push(remainingDimensions.shift())\n    }\n\n    const widthsAtMinimumHeight = accumulatedRowDimensions.map(d => this.widthAtMinimumRowHeight(d));\n    const totalWidthAtMinimumHeight = widthsAtMinimumHeight.reduce((a, b) => { return a + b; }, 0);\n    const widthScaleFactor = Math.min(width / totalWidthAtMinimumHeight, maximumRowHeight / minimumRowHeight);\n    return {\n      next: this.row(accumulatedRowDimensions, widthScaleFactor),\n      remaining: remainingDimensions\n    }\n  }\n\n  makeRows = (accumulatedRows, dimensions) => {\n    const { next, remaining } = this.makeNextRow(dimensions)\n    accumulatedRows.push(next)\n    if (remaining.length > 0) {\n      accumulatedRows.concat(this.makeRows(accumulatedRows, remaining))\n    }\n    return accumulatedRows\n  }\n\n  widthAtMinimumRowHeight = (dimension) => {\n    return this.factorToFitInMinimumRowHeight(dimension) * dimension.x\n  }\n\n  factorToFitInMinimumRowHeight = (dimension) => {\n    return minimumRowHeight / dimension.y\n  }\n\n  getImageDimensions = (id) => {\n    const { images } = this.props\n    const image = images.byId[id]\n    const { width, height } = image\n    switch (image.image_orientation) {\n      case 'LeftBottom':\n        return {\n          x: height,\n          y: width\n        }\n      default:\n        return {\n          x: width,\n          y: height\n        }\n    }\n  }\n\n  makeDimensions = () => {\n    const { images } = this.props\n    return images.allIds.filter((id) => {\n      const { width, height } = images.byId[id]\n      return width && height\n    }).map((id) => {\n      const { x, y } = this.getImageDimensions(id)\n      return this.dimension(x, y)\n    })\n  }\n\n  getItemSize = index => {\n    return this.rows[index].rowHeight\n  };\n\n  render() {\n    const { images, size, renderItem } = this.props\n    const { height, width } = size\n    const imageDimensions = this.makeDimensions()\n    this.rows = this.makeRows([], imageDimensions)\n    const itemData = { rows: this.rows, images, renderItem }\n    return (\n      <VariableSizeList\n        height={height}\n        width={width}\n        itemData={itemData}\n        itemSize={this.getItemSize}\n        itemCount={this.rows.length}\n        ref={(node) => { this.list = node }}\n      >\n        {Row}\n      </VariableSizeList>\n    )\n  }\n}\n"],"names":["Row","memo","data","index","style","rows","images","renderItem","React","contents","length","rowHeight","map","content","i","image","byId","dimension","id","areEqual","propTypes","PropTypes","object","number","minimumRowHeight","maximumRowHeight","DreamGrid","props","x","y","scaleDimension","scale","row","unscaledContents","scaleDueToHeight","width","size","scaledContents","factor","factorToFitInMinimumRowHeight","unscaledDimension","remainingWhitespace","scaledContent","reduce","cur","prev","makeNextRow","remainingDimensions","remainingRowWidth","accumulatedRowDimensions","widthAtMinimumRowHeight","push","shift","widthsAtMinimumHeight","d","totalWidthAtMinimumHeight","a","b","widthScaleFactor","Math","min","makeRows","accumulatedRows","dimensions","next","remaining","concat","getImageDimensions","height","image_orientation","makeDimensions","allIds","filter","getItemSize","list","createRef","prevProps","resetAfterIndex","imageDimensions","itemData","node","Component","objectOf","function"],"mappings":"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"}